# Integration test pipeline configuration
# Exercises all merge/sync patterns with realistic complexity

vault:
  address: http://vault:8200
  auth:
    token: ${VAULT_TOKEN}

aws:
  region: us-east-1
  endpoint: ${AWS_ENDPOINT_URL}

# Sources - KV2 mounts in Vault
sources:
  analytics:
    vault:
      mount: analytics
  data-engineers:
    vault:
      mount: data-engineers
  shared:
    vault:
      mount: shared

# Merge store - intermediate aggregation layer
merge_store:
  vault:
    mount: merged-secrets

# Targets with inheritance chain
# Graph: analytics + data-engineers → Staging → Production → Demo
targets:
  Staging:
    account_id: "111111111111"
    region: us-east-1
    imports:
      - analytics
      - data-engineers
  
  Production:
    account_id: "222222222222"
    region: us-east-1
    imports:
      - Staging  # Inherits ALL secrets from Staging
  
  Demo:
    account_id: "333333333333"
    region: us-east-1
    imports:
      - Production  # Inherits ALL secrets from Production

# Dynamic targets (sandbox accounts)
dynamic_targets:
  engineer_sandboxes:
    discovery:
      identity_center:
        permission_set: "EngineerAccess"
    imports:
      - analytics
      - Staging
      - data-engineers
    exclude:
      - "222222222222"  # Exclude production

# Pipeline settings
pipeline:
  merge:
    parallel: 2
  sync:
    parallel: 2
    delete_orphans: false
  dry_run: false
  continue_on_error: true
